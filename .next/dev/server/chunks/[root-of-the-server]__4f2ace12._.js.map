{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbook/Downloads/hearingaidwebsite12/app/api/send-hearing-test-results/route.tsx"],"sourcesContent":["// Note: API routes don't work with static export\n// This file will be ignored during static build\n\nimport { NextResponse } from \"next/server\"\nimport { Resend } from \"resend\"\nimport type { CustomerData } from \"@/components/customer-data-modal\"\nimport type { HearingTestResult } from \"@/lib/hearing-test-data\"\n\ninterface TestResultRequest {\n  customerData: CustomerData\n  testResults: HearingTestResult\n  leftEarResults: { frequency: number; threshold: number }[]\n  rightEarResults: { frequency: number; threshold: number }[]\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body: TestResultRequest = await request.json()\n    const { customerData, testResults, leftEarResults, rightEarResults } = body\n\n    if (!customerData || !testResults) {\n      console.error(\"[v0] Missing customer data or test results\")\n      return NextResponse.json({ error: \"Missing customer data or test results\" }, { status: 400 })\n    }\n\n    if (!process.env.RESEND_API_KEY) {\n      console.error(\"[v0] RESEND_API_KEY environment variable is not set\")\n      return NextResponse.json(\n        {\n          error: \"Email service not properly configured\",\n          details:\n            \"RESEND_API_KEY environment variable is missing. Please add it to your Vercel project environment variables or local .env.local file.\",\n          setupRequired: true,\n        },\n        { status: 500 },\n      )\n    }\n\n    const resend = new Resend(process.env.RESEND_API_KEY)\n    const recipientEmail = \"adhamemad.oracle@gmail.com\"\n\n    // Calculate averages\n    const leftEarAvg = leftEarResults.reduce((sum, r) => sum + r.threshold, 0) / leftEarResults.length\n    const rightEarAvg = rightEarResults.reduce((sum, r) => sum + r.threshold, 0) / rightEarResults.length\n\n    // Format date\n    const testDate = new Date().toLocaleDateString(\"en-US\", {\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    })\n\n    // Create beautiful HTML email\n    const htmlContent = `\n      <!DOCTYPE html>\n      <html lang=\"en\">\n      <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #1f2937; background: #f3f4f6; }\n          .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1); }\n          \n          /* Header */\n          .header {\n            background: linear-gradient(135deg, #0369a1 0%, #06b6d4 50%, #0d9488 100%);\n            color: white;\n            padding: 50px 40px;\n            text-align: center;\n            position: relative;\n            overflow: hidden;\n          }\n          .header::before {\n            content: '';\n            position: absolute;\n            top: -50%;\n            right: -10%;\n            width: 300px;\n            height: 300px;\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 50%;\n          }\n          .header h1 { font-size: 36px; font-weight: 700; margin-bottom: 10px; position: relative; z-index: 1; }\n          .header p { font-size: 16px; opacity: 0.95; position: relative; z-index: 1; }\n          \n          /* Main content */\n          .content { padding: 50px 40px; }\n          \n          /* Customer info box */\n          .customer-info {\n            background: linear-gradient(135deg, #f0f9ff 0%, #f0fdfa 100%);\n            border-left: 5px solid #0369a1;\n            padding: 25px;\n            margin-bottom: 40px;\n            border-radius: 12px;\n            box-shadow: 0 4px 6px rgba(3, 105, 161, 0.1);\n          }\n          .customer-info h3 { color: #0369a1; font-size: 18px; margin-bottom: 20px; font-weight: 600; }\n          .info-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n          }\n          .info-item { }\n          .info-label { font-weight: 600; color: #0369a1; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }\n          .info-value { color: #111827; font-size: 16px; font-weight: 500; }\n          \n          /* Results section */\n          .results-section {\n            background: white;\n            padding: 40px;\n            margin-bottom: 30px;\n            border-radius: 12px;\n            border: 1px solid #e5e7eb;\n          }\n          .results-section h2 { color: #111827; font-size: 24px; margin-bottom: 25px; border-bottom: 3px solid #06b6d4; padding-bottom: 15px; font-weight: 700; }\n          \n          /* Assessment box */\n          .assessment-box {\n            background: linear-gradient(135deg, #ecf0f1 0%, #f8f9fa 100%);\n            padding: 30px;\n            border-radius: 12px;\n            margin-bottom: 30px;\n            text-align: center;\n            border: 2px solid #0369a1;\n          }\n          .assessment-status { font-size: 28px; font-weight: 700; color: #0369a1; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }\n          .assessment-desc { font-size: 15px; color: #4b5563; font-weight: 500; }\n          \n          /* Frequency results */\n          .frequency-results {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin-top: 25px;\n          }\n          .ear-results {\n            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n            padding: 25px;\n            border-radius: 12px;\n            border-left: 5px solid #06b6d4;\n          }\n          .ear-results h3 { color: #06b6d4; font-size: 18px; margin-bottom: 20px; text-align: center; font-weight: 700; }\n          .frequency-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 0;\n            border-bottom: 1px solid #e5e7eb;\n          }\n          .frequency-item:last-child { border-bottom: none; }\n          .freq-label { font-size: 13px; font-weight: 600; color: #374151; }\n          .freq-bar {\n            width: 45%;\n            height: 10px;\n            background: #e5e7eb;\n            border-radius: 5px;\n            overflow: hidden;\n            margin: 0 12px;\n            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);\n          }\n          .freq-bar-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #0369a1 0%, #06b6d4 50%, #0d9488 100%);\n            border-radius: 5px;\n          }\n          .freq-value { font-size: 13px; font-weight: 700; color: #0369a1; min-width: 40px; text-align: right; }\n          \n          /* Recommendations */\n          .recommendations {\n            background: linear-gradient(135deg, #f0fdf4 0%, #f0fdfa 100%);\n            border-left: 5px solid #0d9488;\n            padding: 25px;\n            border-radius: 12px;\n            margin-top: 25px;\n            box-shadow: 0 4px 6px rgba(13, 148, 136, 0.1);\n          }\n          .recommendations h3 { color: #0d9488; font-size: 18px; margin-bottom: 15px; font-weight: 700; }\n          .recommendations ul { padding-left: 20px; }\n          .recommendations li { margin-bottom: 10px; font-size: 14px; color: #374151; line-height: 1.6; }\n          \n          /* Footer */\n          .footer {\n            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);\n            color: white;\n            padding: 40px;\n            text-align: center;\n            font-size: 13px;\n          }\n          .footer p { margin-bottom: 10px; opacity: 0.9; }\n          .footer a { color: #06b6d4; text-decoration: none; font-weight: 600; }\n          .footer .disclaimer { margin-top: 25px; padding-top: 25px; border-top: 1px solid #374151; font-style: italic; color: #9ca3af; line-height: 1.8; }\n          \n          /* Responsive */\n          @media (max-width: 600px) {\n            .info-grid { grid-template-columns: 1fr; }\n            .frequency-results { grid-template-columns: 1fr; }\n            .header h1 { font-size: 28px; }\n            .header, .content, .results-section, .customer-info, .recommendations, .footer { padding: 25px; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <!-- Header -->\n          <div class=\"header\">\n            <h1>Al-Barakat Hearing Care</h1>\n            <p>Your Professional Hearing Test Results</p>\n          </div>\n          \n          <!-- Content -->\n          <div class=\"content\">\n            <!-- Customer Info -->\n            <div class=\"customer-info\">\n              <h3>Patient Information</h3>\n              <div class=\"info-grid\">\n                <div class=\"info-item\">\n                  <div class=\"info-label\">Full Name</div>\n                  <div class=\"info-value\">${customerData.name}</div>\n                </div>\n                <div class=\"info-item\">\n                  <div class=\"info-label\">Age</div>\n                  <div class=\"info-value\">${customerData.age} years old</div>\n                </div>\n                <div class=\"info-item\">\n                  <div class=\"info-label\">Gender</div>\n                  <div class=\"info-value\">${customerData.gender.charAt(0).toUpperCase() + customerData.gender.slice(1)}</div>\n                </div>\n                <div class=\"info-item\">\n                  <div class=\"info-label\">Mobile</div>\n                  <div class=\"info-value\">${customerData.mobile}</div>\n                </div>\n                <div class=\"info-item\">\n                  <div class=\"info-label\">Email</div>\n                  <div class=\"info-value\">${customerData.email}</div>\n                </div>\n                <div class=\"info-item\">\n                  <div class=\"info-label\">Preferred Branch</div>\n                  <div class=\"info-value\">${customerData.selectedBranch?.city || \"Not specified\"}</div>\n                </div>\n              </div>\n            </div>\n            \n            <!-- Results -->\n            <div class=\"results-section\">\n              <h2>Test Results & Assessment</h2>\n              \n              <div class=\"assessment-box\">\n                <div class=\"assessment-status\">${testResults.overallAssessment.replace(/-/g, \" \")}</div>\n                <div class=\"assessment-desc\">${testResults.overallAssessment === \"normal\" ? \"Your hearing test shows normal hearing levels\" : \"Your hearing test may indicate hearing concerns\"}</div>\n              </div>\n              \n              <div class=\"frequency-results\">\n                <div class=\"ear-results\">\n                  <h3>üëÇ LEFT EAR</h3>\n                  ${leftEarResults\n                    .map(\n                      (result) => `\n                    <div class=\"frequency-item\">\n                      <span class=\"freq-label\">${result.frequency} Hz</span>\n                      <div class=\"freq-bar\">\n                        <div class=\"freq-bar-fill\" style=\"width: ${(1 - result.threshold) * 100}%\"></div>\n                      </div>\n                      <span class=\"freq-value\">${Math.round((1 - result.threshold) * 100)}%</span>\n                    </div>\n                  `,\n                    )\n                    .join(\"\")}\n                </div>\n                \n                <div class=\"ear-results\">\n                  <h3>üëÇ RIGHT EAR</h3>\n                  ${rightEarResults\n                    .map(\n                      (result) => `\n                    <div class=\"frequency-item\">\n                      <span class=\"freq-label\">${result.frequency} Hz</span>\n                      <div class=\"freq-bar\">\n                        <div class=\"freq-bar-fill\" style=\"width: ${(1 - result.threshold) * 100}%\"></div>\n                      </div>\n                      <span class=\"freq-value\">${Math.round((1 - result.threshold) * 100)}%</span>\n                    </div>\n                  `,\n                    )\n                    .join(\"\")}\n                </div>\n              </div>\n              \n              <div class=\"recommendations\">\n                <h3>üìã Recommended Actions</h3>\n                <ul>\n                  ${testResults.recommendations.map((rec) => `<li>${rec}</li>`).join(\"\")}\n                </ul>\n              </div>\n            </div>\n          </div>\n          \n          <!-- Footer -->\n          <div class=\"footer\">\n            <p><strong>Test Completed:</strong> ${testDate}</p>\n            <p>Al-Barakat Hearing Care Centers | Professional Hearing Healthcare</p>\n            <div class=\"disclaimer\">\n              <p>‚ö†Ô∏è IMPORTANT DISCLAIMER: This online hearing test is a preliminary screening tool and does not replace a comprehensive audiological evaluation. Please consult with our certified audiologists for accurate diagnosis and personalized treatment recommendations.</p>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `\n\n    // Send email\n    const data = await resend.emails.send({\n      from: \"Al-Barakat Hearing Care <onboarding@resend.dev>\",\n      to: [recipientEmail],\n      replyTo: customerData.email,\n      subject: `Hearing Test Results - ${customerData.name}`,\n      html: htmlContent,\n    })\n\n    const emailId = (data as any)?.id ?? null\n\n    console.log(\"[v0] Hearing test results email sent successfully to\", recipientEmail, \"with ID:\", emailId)\n\n    return NextResponse.json({\n      success: true,\n      message: \"Test results sent successfully\",\n      id: emailId,\n      recipientEmail,\n    })\n  } catch (error: any) {\n    console.error(\"[v0] Error sending test results email:\", error.message)\n    return NextResponse.json(\n      {\n        error: \"Failed to send test results email\",\n        details: error.message || \"Unknown error occurred\",\n      },\n      { status: 500 },\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}